name: CI  # Name of the workflow

on: [pull_request]  # Trigger the workflow on pull requests

jobs:  # Define jobs for the workflow
  build:  # Job name
    runs-on: ubuntu-latest  # Specify the environment to run the job

    steps:  # Steps to execute in the job
    - name: Checkout code  # Step to checkout the repository code
      uses: actions/checkout@v2  # Use the checkout action

    - name: Install dependencies  # Step to install necessary dependencies
      run: |  # Run command to install dependencies
        sudo apt-get update  # Update the package list
        sudo apt-get install -y graphviz  # Install graphviz

    - name: Make script executable  # Step to make the script executable
      run: chmod +x ./bin/fastq-peak.sh  # Change permissions to make the script executable

    - name: Run fastq-peak script  # Step to run the script
      id: run_script  # ID for referencing this step
      run: ./bin/fastq-peak.sh ./data/sample.fastq  # Command to run the script with the sample FASTQ file

    - name: Verify output  # Step to verify the script output
      run: |  # Run command to verify output
        # Capture the actual output of the script
        ACTUAL_OUTPUT=$(./bin/fastq-peak.sh ./data/sample.fastq)

        # Print the actual output for debugging
        echo "Actual Output:"
        echo "$ACTUAL_OUTPUT"

        # Check if the actual output contains the expected string
        if echo "$ACTUAL_OUTPUT" | grep -q "Number of reads in ./data/sample.fastq: 2"; then
          echo "Output contains the expected result."
        else
          echo "Output did not contain the expected result."
          exit 1  # Exit with an error code if the expected string is not found
        fi  # Close the if statement block
      shell: bash  # Specify the shell to use for running the commands
